<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scan Kehadiran</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#000;
  color:white;
  text-align:center;
}

.topbar{
  padding:12px;
  font-size:18px;
  font-weight:bold;
  background:#111;
}

/* reader JANGAN pakai height tetap */
#reader{
  width:100%;
  max-width:500px;
  margin:12px auto;
}

/* paksa video terlihat */
#reader video{
  width:100% !important;
  height:auto !important;
  display:block;
  border-radius:12px;
}

#status{
  padding:14px;
  font-size:16px;
}
.success{color:green}
.error{color:red}
</style>
</head>

<body>
<div class="topbar">Scan QR Kehadiran</div>
<div id="reader"></div>
<div id="status">Arahkan kamera ke QR tamu</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAbFiLWZS5H1672SpouCn1deEAAn4qVqDs",
  databaseURL: "https://undanganwidi-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();

function onScanSuccess(decodedText) {

  const [idTamu, nama] = decodedText.split("|");
  if(!idTamu) return;

  const ref = db.ref("bukutamu/" + idTamu);

  ref.once("value", snap => {
    if(!snap.exists()){
      ref.set({
        nama: nama,
        hadir: true,
        waktuHadir: Date.now(),
        pesan: "",
        like: 0
      });
    } else {
      ref.update({
        hadir: true,
        waktuHadir: Date.now()
      });
    }
  });

  document.getElementById("status").innerHTML =
    "âœ… Kehadiran dicatat: <b>" + nama + "</b>";
}

const scanner = new Html5QrcodeScanner(
  "reader",
  { fps: 10, qrbox: 250 },
  false
);

scanner.render(onScanSuccess);
</script>
</body>
</html>
